# ansible_postfix

This role sets a debian based system up for use as a Mailserver by installing and configuring postfix.
Additionally it can install and configure OpenDKIM for DKIM signing/verification and saslauthd for complex authentication scenarios involving users provisioned to a LDAP directory.


## Requirements

This role assumes the presence of necessary DNS-Records (MX, SPF and DKIM) for email delivery.
It is developed and tested on a plain Debian install, but may work for Debian derivatives.


## Role Variables


| Name       |     Required/Default     | Description                                                                                        |
| ---------- | :----------------------: | -------------------------------------------------------------------------------------------------- |
| `example2` | :heavy_multiplication_x: | Sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. |
| `example3` |          `True`          | Stet clita kasd gubergren                                                                          |
| `example4` |           `5`            | No sea takimata sanctus est Lorem ipsum dolor sit amet.                                            |


### Saslauthd
If you need to authenticate users against a LDAP directory, you can enable SASL authentication by defining `postfix_sasl_enabled` and setting it to `True`.
The default configuration looks like this:

```
ldap_servers: "{{ postfix_ldap_servers }}"
ldap_search_base: "{{ postfix_ldap_search_base }}"
ldap_auth_method: bind
```

If you need bind credentials or other additional configuration options, you can override the default by setting `postfix_saslauthd_options`.
This dict will be parsed and written to the saslauthd config file.
The above default config is generated by this dict:

```yaml
postfix_saslauthd_options:
  ldap_servers: "{{ postfix_ldap_servers }}"
  ldap_search_base: "{{ postfix_ldap_search_base }}"
  ldap_auth_method: bind
```

### OpenDKIM

If you want to add DKIM signing/checking, this role can install and configure OpenDKIM.
This can be enabled by defining `postfix_opendkim_enabled` and setting it to `True`.

The default config shown below, sets OpenDKIM up in verifier mode, listening at `localhost:12301`:

```
Syslog                  yes
SyslogSuccess           yes
Mode                    v

# In Debian, opendkim runs as user "opendkim". A umask of 007 is required when
# using a local socket with MTAs that access the socket as a non-privileged
# user (for example, Postfix). You may need to add user "postfix" to group
# "opendkim" in that case.
UserID                  opendkim
UMask                   007

# Socket for the MTA connection (required).
Socket                  inet:12301@localhost
PidFile                 /run/opendkim/opendkim.pid

# The trust anchor enables DNSSEC. In Debian, the trust anchor file is provided
# by the package dns-root-data.
TrustAnchorFile         /usr/share/dns/root.key
```

If you have different requirements, you can simply override the config by setting `postfix_opendkim_config`.

### Additional configs


## Example

This example assumes that the role has been cloned to `roles/postfix`

```yml
```


## License

This work is licensed under the [MIT License](./LICENSE).


## Author Information

- [Sven Feyerabend (SF2311)](https://github.com/SF2311) _sven.feyerabend at stuvus.uni-stuttgart.de_
